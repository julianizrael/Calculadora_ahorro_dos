<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora de Ahorro</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 1rem;
      background: #f4f4f4;
    }
    .tabs {
      display: flex;
      margin-bottom: 1rem;
    }
    .tab {
      padding: 0.5rem 1rem;
      margin-right: 1rem;
      background: #ddd;
      cursor: pointer;
      border-radius: 0.5rem 0.5rem 0 0;
    }
    .tab.active {
      background: #555;
      color: #fff;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    .input-group {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .input-group div {
      display: flex;
      flex-direction: column;
      min-width: 130px;
    }
    .input-group label {
      font-size: 0.9rem;
      margin-bottom: 0.25rem;
    }
    .input-group input {
      padding: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 0.25rem;
    }
    .hitos-list-item {
      display: flex;
      justify-content: space-between;
      margin: 0.25rem 0;
      background: #eee;
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
    }
    #tableContainer {
      margin: 1rem 0;
      overflow-x: auto;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      font-size: 0.9rem;
      background: #fff;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 0.5rem;
      text-align: center;
    }
    #toggleTableBtn {
      margin: 1rem 0;
      padding: 0.5rem 1rem;
      background: #555;
      color: #fff;
      border: none;
      border-radius: 0.25rem;
      cursor: pointer;
    }
    canvas {
      max-width: 800px;
      margin-top: 2rem;
      background: #fff;
      padding: 1rem;
      border-radius: 0.5rem;
    }
  </style>
</head>
<body>
  <h1>Calculadora de Ahorro</h1>
  <div class="tabs">
    <div class="tab active" data-tab="basico">Básico</div>
    <div class="tab" data-tab="avanzado">Avanzado</div>
  </div>

  <div id="basico" class="tab-content active">
    <form id="formBasico">
      <div class="input-group">
        <div><label>Edad inicio<input type="number" id="edadInicioBasico"></label></div>
        <div><label>Edad fin<input type="number" id="edadFinBasico"></label></div>
        <div><label>Monto inicial<input type="number" id="montoInicialBasico" value="0"></label></div>
        <div><label>Aporte mensual<input type="number" id="aporteMensualBasico"></label></div>
        <div><label>Rendimiento anual (%)<input type="number" id="rendimientoBasico"></label></div>
        <div><label>Inflación anual (%)<input type="number" id="inflacionBasico"></label></div>
      </div>
    </form>
  </div>

  <div id="avanzado" class="tab-content">
    <form id="formAvanzado">
      <div class="input-group">
        <div><label>Edad inicio<input type="number" id="edadInicioAdv"></label></div>
        <div><label>Edad cambio 1<input type="number" id="edadCambio1Adv"></label></div>
        <div><label>Edad cambio 2<input type="number" id="edadCambio2Adv"></label></div>
        <div><label>Edad fin<input type="number" id="edadFinAdv"></label></div>
      </div>
      <div class="input-group">
        <div><label>Aporte tramo 1<input type="number" id="aporteTramo1"></label></div>
        <div><label>Aporte tramo 2<input type="number" id="aporteTramo2"></label></div>
        <div><label>Aporte tramo 3<input type="number" id="aporteTramo3"></label></div>
        <div><label>Monto inicial<input type="number" id="montoInicialAdv" value="0"></label></div>
        <div><label>Rendimiento anual (%)<input type="number" id="rendimientoAdv"></label></div>
        <div><label>Inflación anual (%)<input type="number" id="inflacionAdv"></label></div>
      </div>
      <div class="input-group">
        <div><label>Edad hito<input type="number" id="edadHito"></label></div>
        <div><label>Gasto hito<input type="number" id="gastoHito"></label></div>
        <div><button type="button" id="addHitoBtn">Agregar hito</button></div>
      </div>
      <div id="listaHitos"></div>
    </form>
  </div>

  <button id="toggleTableBtn">Ocultar tabla</button>
  <div id="tableContainer"></div>
  <canvas id="chartNominal"></canvas>
  <canvas id="chartReal"></canvas>

  <script>
    let hitos = [];
    let tablaVisible = true;

    function calcularBasico() {
      const e0 = +document.getElementById('edadInicioBasico').value;
      const eF = +document.getElementById('edadFinBasico').value;
      const aporteMensual = +document.getElementById('aporteMensualBasico').value;
      const rendimiento = +document.getElementById('rendimientoBasico').value / 100;
      const inflacion = +document.getElementById('inflacionBasico').value / 100;
      const inicial = +document.getElementById('montoInicialBasico').value;
      let saldo = inicial;
      const resultados = [];

      for (let edad = e0; edad <= eF; edad++) {
        saldo += aporteMensual * 12;
        saldo *= 1 + rendimiento;
        resultados.push({ edad, saldo });
      }

      renderResultados(resultados, e0, inflacion);
    }

    function calcularAvanzado() {
      const e0 = +document.getElementById('edadInicioAdv').value;
      const e1 = +document.getElementById('edadCambio1Adv').value;
      const e2 = +document.getElementById('edadCambio2Adv').value;
      const eF = +document.getElementById('edadFinAdv').value;
      const a1 = +document.getElementById('aporteTramo1').value * 12;
      const a2 = +document.getElementById('aporteTramo2').value * 12;
      const a3 = +document.getElementById('aporteTramo3').value * 12;
      const rendimiento = +document.getElementById('rendimientoAdv').value / 100;
      const inflacion = +document.getElementById('inflacionAdv').value / 100;
      const inicial = +document.getElementById('montoInicialAdv').value;
      let saldo = inicial;
      const resultados = [];

      for (let edad = e0; edad <= eF; edad++) {
        let aporte = edad < e1 ? a1 : edad < e2 ? a2 : a3;
        let gastos = hitos.filter(h => h.edad === edad).reduce((acc, h) => acc + h.gasto, 0);
        saldo += aporte - gastos;
        saldo *= 1 + rendimiento;
        resultados.push({ edad, saldo });
      }

      renderResultados(resultados, e0, inflacion);
    }

    function renderResultados(data, e0, inflacion) {
      const table = data.map(r => {
        const real = r.saldo / Math.pow(1 + inflacion, r.edad - e0);
        return `<tr><td>${r.edad}</td><td>${r.saldo.toFixed(2)}</td><td>${real.toFixed(2)}</td></tr>`;
      }).join('');
      document.getElementById('tableContainer').innerHTML = `
        <table><tr><th>Edad</th><th>Saldo nominal</th><th>Saldo real</th></tr>${table}</table>`;

      const labels = data.map(r => r.edad);
      const nominal = data.map(r => r.saldo);
      const real = data.map(r => r.saldo / Math.pow(1 + inflacion, r.edad - e0));

      new Chart(document.getElementById('chartNominal'), {
        type: 'line',
        data: { labels, datasets: [{ label: 'Saldo Nominal', data: nominal, borderColor: 'blue', fill: false }] },
        options: { responsive: true }
      });

      new Chart(document.getElementById('chartReal'), {
        type: 'line',
        data: { labels, datasets: [{ label: 'Saldo Real', data: real, borderColor: 'green', fill: false }] },
        options: { responsive: true }
      });
    }

    function autoCalcular() {
      if (document.getElementById('basico').classList.contains('active')) calcularBasico();
      else calcularAvanzado();
    }

    document.querySelectorAll('input').forEach(input => input.addEventListener('input', autoCalcular));
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tab.dataset.tab).classList.add('active');
        autoCalcular();
      });
    });

    document.getElementById('addHitoBtn').addEventListener('click', () => {
      const edad = +document.getElementById('edadHito').value;
      const gasto = +document.getElementById('gastoHito').value;
      if (!isNaN(edad) && !isNaN(gasto)) {
        hitos.push({ edad, gasto });
        renderHitos();
        autoCalcular();
      }
    });

    function renderHitos() {
      const lista = document.getElementById('listaHitos');
      lista.innerHTML = '';
      hitos.forEach((h, i) => {
        const div = document.createElement('div');
        div.className = 'hitos-list-item';
        div.innerHTML = `Edad: ${h.edad} - Gasto: $${h.gasto} <button onclick="eliminarHito(${i})">X</button>`;
        lista.appendChild(div);
      });
    }

    function eliminarHito(index) {
      hitos.splice(index, 1);
      renderHitos();
      autoCalcular();
    }

    document.getElementById('toggleTableBtn').addEventListener('click', () => {
      tablaVisible = !tablaVisible;
      document.getElementById('tableContainer').style.display = tablaVisible ? 'block' : 'none';
      document.getElementById('toggleTableBtn').textContent = tablaVisible ? 'Ocultar tabla' : 'Mostrar tabla';
    });
  </script>
</body>
</html>
