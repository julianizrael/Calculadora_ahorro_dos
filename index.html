<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calculadora de Ahorro</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 1rem;
      background: #f0f4ff;
      color: #003366;
      transition: background 0.3s, color 0.3s;
    }
    body.night {
      background: #121b2a;
      color: #cbd6f7;
    }
    .tabs {
      display: flex;
      margin-bottom: 1rem;
      border-bottom: 2px solid #003366;
    }
    .tab {
      padding: 0.5rem 1.5rem;
      margin-right: 1rem;
      background: #b3c7ff;
      color: #003366;
      cursor: pointer;
      border-radius: 0.5rem 0.5rem 0 0;
      user-select: none;
      font-weight: 600;
      transition: background 0.3s, color 0.3s;
    }
    .tab.active {
      background: #003366;
      color: #ffffff;
    }
    .tab-content {
      display: none;
      background: #d6e0ff;
      border-radius: 0 0 0.5rem 0.5rem;
      padding: 1rem;
      box-shadow: 0 0 8px rgba(0, 51, 102, 0.2);
    }
    .tab-content.active {
      display: block;
    }
  </style>
</head>
<body>
  <h1>Calculadora de Ahorro</h1>
  <div class="tabs">
    <div class="tab active" data-tab="basico">Básico</div>
    <div class="tab" data-tab="avanzado">Avanzado</div>
  </div>

  <div id="basico" class="tab-content active">
    <form id="formBasico" onsubmit="return false;">
      <label>Edad inicio: <input type="number" id="edadInicioBasico" value="25"></label>
      <label>Edad fin: <input type="number" id="edadFinBasico" value="65"></label>
      <label>Monto inicial: <input type="number" id="montoInicialBasico" value="0"></label>
      <label>Aporte mensual: <input type="number" id="aporteMensualBasico" value="100"></label>
      <label>Rendimiento anual (%): <input type="number" id="rendimientoBasico" value="5"></label>
      <label>Inflación anual (%): <input type="number" id="inflacionBasico" value="3"></label>
    </form>
  </div>

  <div id="avanzado" class="tab-content">
    <form id="formAvanzado" onsubmit="return false;">
      <label>Monto inicial: <input type="number" id="montoInicialAdv" value="0"></label>
      <label>Edad inicio: <input type="number" id="edadInicioAdv" value="25"></label>
      <label>Aporte tramo 1: <input type="number" id="aporteTramo1" value="1200"></label>
      <label>Edad cambio 1: <input type="number" id="edadCambio1Adv" value="35"></label>
      <label>Aporte tramo 2: <input type="number" id="aporteTramo2" value="1500"></label>
      <label>Edad cambio 2: <input type="number" id="edadCambio2Adv" value="50"></label>
      <label>Aporte tramo 3: <input type="number" id="aporteTramo3" value="1800"></label>
      <label>Edad fin: <input type="number" id="edadFinAdv" value="65"></label>
      <label>Rendimiento anual (%): <input type="number" id="rendimientoAdv" value="5"></label>
      <label>Inflación anual (%): <input type="number" id="inflacionAdv" value="3"></label>
    </form>
  </div>

  <div id="resumen"></div>
  <div style="max-width:850px; margin: 0 auto;">
    <button id="toggleTableBtn">Ocultar tabla</button>
    <button id="toggleNightBtn">Modo noche</button>
  </div>
  <div id="tableContainer"></div>
  <canvas id="chartGeneral"></canvas>

  <script>
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tab.dataset.tab).classList.add('active');
        autoCalcular();
      });
    });

    document.querySelectorAll('input').forEach(input => {
      input.addEventListener('input', autoCalcular);
    });

    function autoCalcular() {
      if (document.querySelector('.tab.active').dataset.tab === 'basico') calcularBasico();
      else calcularAvanzado();
    }

    function calcularBasico() {
      const edadInicio = +document.getElementById('edadInicioBasico').value;
      const edadFin = +document.getElementById('edadFinBasico').value;
      const montoInicial = +document.getElementById('montoInicialBasico').value;
      const aporteMensual = +document.getElementById('aporteMensualBasico').value * 12;
      const rendimiento = +document.getElementById('rendimientoBasico').value / 100;
      const inflacion = +document.getElementById('inflacionBasico').value / 100;
      if (!edadInicio || !edadFin || edadFin < edadInicio) return;

      let saldo = montoInicial;
      const data = [];

      for (let edad = edadInicio; edad <= edadFin; edad++) {
        saldo += aporteMensual;
        saldo *= 1 + rendimiento;
        data.push({ edad, saldo });
      }

      renderResultados(data, edadInicio, inflacion);
    }

    function calcularAvanzado() {
      const e0 = +document.getElementById('edadInicioAdv').value;
      const e1 = +document.getElementById('edadCambio1Adv').value;
      const e2 = +document.getElementById('edadCambio2Adv').value;
      const eF = +document.getElementById('edadFinAdv').value;
      const a1 = +document.getElementById('aporteTramo1').value * 12;
      const a2 = +document.getElementById('aporteTramo2').value * 12;
      const a3 = +document.getElementById('aporteTramo3').value * 12;
      const rendimiento = +document.getElementById('rendimientoAdv').value / 100;
      const inflacion = +document.getElementById('inflacionAdv').value / 100;
      const inicial = +document.getElementById('montoInicialAdv').value;

      let saldo = inicial;
      const data = [];

      for (let edad = e0; edad <= eF; edad++) {
        const aporte = edad < e1 ? a1 : edad < e2 ? a2 : a3;
        saldo += aporte;
        saldo *= 1 + rendimiento;
        data.push({ edad, saldo });
      }

      renderResultados(data, e0, inflacion);
    }

    function renderResultados(data, e0, inflacion) {
      if (!data.length) return;
      const labels = data.map(d => d.edad);
      const nominal = data.map(d => d.saldo);
      const real = data.map(d => d.saldo / Math.pow(1 + inflacion, d.edad - e0));

      document.getElementById('tableContainer').innerHTML = `
        <table>
          <thead><tr><th>Edad</th><th>Saldo Nominal</th><th>Saldo Real</th></tr></thead>
          <tbody>
            ${data.map((d, i) => `<tr><td>${d.edad}</td><td>${d.saldo.toFixed(2)}</td><td>${real[i].toFixed(2)}</td></tr>`).join('')}
          </tbody>
        </table>`;

      const ctx = document.getElementById('chartGeneral');
      if (window.chartGeneral) window.chartGeneral.destroy();
      window.chartGeneral = new Chart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [
            {
              label: 'Saldo Nominal',
              data: nominal,
              borderColor: '#3366cc',
              fill: false,
              tension: 0.2
            },
            {
              label: 'Saldo Real',
              data: real,
              borderColor: '#dc3912',
              fill: false,
              tension: 0.2
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'top',
              labels: {
                color: document.body.classList.contains('night') ? '#cbd6f7' : '#003366'
              }
            }
          },
          scales: {
            x: {
              ticks: {
                color: document.body.classList.contains('night') ? '#cbd6f7' : '#003366'
              }
            },
            y: {
              ticks: {
                color: document.body.classList.contains('night') ? '#cbd6f7' : '#003366'
              }
            }
          }
        }
      });

      const final = data[data.length - 1];
      const realFinal = final.saldo / Math.pow(1 + inflacion, final.edad - e0);
      document.getElementById('resumen').textContent =
        `A los ${final.edad} años tendrás $${final.saldo.toFixed(2)} (equivalente a $${realFinal.toFixed(2)} de hoy).`;
    }
  </script>
</body>
</html>
